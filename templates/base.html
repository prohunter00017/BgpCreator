<!doctype html>
<html lang="{{ language }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="locale" content="{{ locale }}">
  <title>{{ page_title }} – {{ site_name }}</title>
  <meta name="description" content="{{ page_description }}">
  <link rel="canonical" href="{{ canonical_url }}">
  <meta name="robots" content="{{ robots_content }}">
  
  <!-- Core Web Vitals Optimizations -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preload" href="styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="styles.css"></noscript>
  
  <!-- Optimize font loading -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
  
  <!-- Open Graph -->
  <meta property="og:type" content="{{ og_type }}">
  <meta property="og:site_name" content="{{ site_name }}">
  <meta property="og:title" content="{{ page_title }} – {{ site_name }}">
  <meta property="og:description" content="{{ page_description }}">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:image" content="{{ site_url }}{{ og_image }}">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title }} – {{ site_name }}">
  <meta name="twitter:description" content="{{ page_description }}">
  <meta name="twitter:image" content="{{ site_url }}{{ og_image }}">

  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="{{ theme_color }}">
  
  <!-- Favicon links for different sizes and devices -->
  {% for favicon in favicon_links %}
  <link rel="{{ favicon.rel }}" type="{{ favicon.type }}"{% if favicon.sizes %} sizes="{{ favicon.sizes }}"{% endif %} href="{{ favicon.href }}">
  {% endfor %}

  <style>
    /* Critical CSS - Above the fold styles */
    :root{
      --bg:{{ css_bg }}; --fg:{{ css_fg }}; --muted:{{ css_muted }}; --brand:{{ css_brand }}; --brand-2:{{ css_brand_2 }}; --surface:{{ css_surface }}; --radius:{{ css_radius }};
      font-family: {{ css_font_family }};
    }
    *{box-sizing:border-box}
    html:focus-within{scroll-behavior:smooth}
    body{margin:0;background:var(--bg);color:var(--fg);line-height:1.6;font-display:swap}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    :focus{outline:2px solid var(--brand);outline-offset:2px}
    .container{max-width:{{ container_max_width }};margin-inline:auto;padding:1rem}
    header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #e5e7eb;z-index:20}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:.5rem}
    .brand{display:flex;align-items:center;gap:.5rem;font-weight:700;flex-shrink:0}
    .brand-link{display:flex;align-items:center;text-decoration:none;color:inherit}
    .brand-link:hover{text-decoration:none}
    .brand-logo{width:300px;height:50px;object-fit:contain;flex-shrink:0}
    nav ul{display:flex;gap:.5rem;list-style:none;margin:0;padding:0;flex-wrap:wrap}
    .nav-link{padding:.5rem .6rem;border-radius:8px;white-space:nowrap;font-size:.9rem;max-width:120px;overflow:hidden;text-overflow:ellipsis;display:block;text-decoration:none}
    .nav-link:focus,.nav-link:hover{background:var(--surface);text-decoration:none}
    .menu-btn{display:none;background:var(--surface);border:1px solid #e5e7eb;padding:.75rem 1rem;border-radius:8px;flex-shrink:0;font-weight:500;color:var(--fg);cursor:pointer;transition:all 0.2s ease}
    .menu-btn:hover{background:var(--brand);color:#fff;border-color:var(--brand)}
    .menu-btn:focus{outline:2px solid var(--brand);outline-offset:2px}

    /* More dropdown (desktop) */
    .more{position:relative}
    .more > button{padding:.5rem .6rem;border-radius:8px;border:1px solid #e5e7eb;background:var(--surface);cursor:pointer}
    .more[aria-expanded="true"] > button,.more > button:hover{background:var(--brand);color:#fff;border-color:var(--brand)}
    .more-menu{display:none;position:absolute;top:110%;right:0;min-width:220px;background:#fff;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.12);padding:.5rem;z-index:50}
    .more[aria-expanded="true"] .more-menu{display:block}
    .more-menu a{display:block;padding:.5rem .6rem;border-radius:8px}
    .more-menu a:hover{background:var(--surface);text-decoration:none}

    @media (max-width: 760px){
      nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:saturate(180%) blur(8px);border:1px solid #e5e7eb;border-radius:0 0 12px 12px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);z-index:30}
      nav[aria-expanded="true"] ul{display:flex;flex-direction:column;align-items:stretch;padding:1rem 0;gap:0}
      nav[aria-expanded="true"] .nav-link{max-width:none;white-space:normal;padding:1rem 1.5rem;width:100%;border-radius:0;text-align:left;font-size:1rem;border-bottom:1px solid #f3f4f6}
      nav[aria-expanded="true"] .nav-link:last-child{border-bottom:none}
      nav[aria-expanded="true"] .nav-link:hover{background:var(--surface)}
      .menu-btn{display:inline-block;position:relative;z-index:40}
    }
    
    @media (max-width: 480px){
      .nav-link{max-width:100px;font-size:.85rem;padding:.4rem .5rem}
      .brand-logo{width:250px;height:42px}
    }

    main{display:block}
    .main-layout{display:grid;grid-template-columns:1fr 280px;gap:2rem;align-items:start}
    .sidebar{position:sticky;top:100px;background:var(--surface);border:1px solid #e5e7eb;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
    .sidebar h3{margin:0 0 1rem;font-size:1.1rem;font-weight:600;color:var(--fg)}
    .games-widget{display:flex;flex-direction:column;gap:0.75rem}
.game-widget-item{display:flex;align-items:center;text-decoration:none;color:inherit;transition:transform 0.2s ease;gap:0.75rem;padding:0.5rem;border-radius:8px;background:rgba(255,255,255,0.5);border:1px solid rgba(229,231,235,0.5)}
.game-widget-item:hover{transform:translateY(-1px);text-decoration:none;background:rgba(255,255,255,0.8);border-color:var(--brand)}
    .game-widget-thumb{width:50px;height:50px;object-fit:cover;border-radius:8px;display:block;flex-shrink:0;content-visibility:auto}
.game-widget-title{font-size:0.85rem;font-weight:500;line-height:1.3;margin:0;flex:1;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .sidebar-toggle{display:none;background:var(--brand);color:#fff;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;margin-bottom:1rem;font-weight:500}
    footer{padding:2rem 1rem;border-top:1px solid #e5e7eb;background:#fff;text-align:center}
    @media (max-width: 1024px) {
      .main-layout{grid-template-columns:1fr}
      .sidebar{position:static;margin-top:2rem}
      .sidebar-toggle{display:block}
      .sidebar.collapsed{display:none}
    }
    .footer-links{display:flex;flex-wrap:wrap;gap:.75rem;justify-content:center;margin:.5rem 0}

    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{position:static;width:auto;height:auto;padding:.5rem;border:1px dashed var(--brand);background:#fff}
    
    {% block extra_css %}{% endblock %}
  </style>

  {% block extra_head %}{% endblock %}

  {% if organization_schema and organization_schema.name %}
  <!-- Schema.org JSON-LD - Organization Schema -->
  <script type="application/ld+json">
  {{ organization_schema | tojson | safe }}
  </script>
  {% endif %}
  
  {% if website_schema %}
  <!-- Schema.org JSON-LD - WebSite Schema -->
  <script type="application/ld+json">
  {{ website_schema | tojson | safe }}
  </script>
  {% endif %}
  
  <!-- Custom Head Code (Analytics, Pixels, etc.) -->
  {% if custom_head_code %}
  {{ custom_head_code | safe }}
  {% endif %}
  
  <!-- Google Analytics -->
  {% if google_analytics_code %}
  {{ google_analytics_code | safe }}
  {% endif %}
  
</head>
<body>
  <!-- Custom Body Code (Widgets, Popups, etc.) -->
  {% if custom_body_code %}
  {{ custom_body_code | safe }}
  {% endif %}
  
  <a class="skip-link" href="#content">Skip to content</a>
  <header>
    <div class="container topbar" role="banner">
      <div class="brand" aria-label="Site brand">
        <a href="{% if current_page == 'index' %}{{ site_url.rstrip('/') }}{% else %}index.html{% endif %}" class="brand-link" {% if current_page == 'index' %}aria-current="page"{% endif %}>
          <img src="logo.png" alt="Slither io" class="brand-logo">
        </a>
      </div>
      <button id="menu" class="menu-btn" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">Menu</button>
      <nav id="nav" aria-label="Primary">
        {% set primary = navigation[:5] %}
        {% set overflow = navigation[5:] %}
        <ul>
          {% for nav_item in primary %}
          <li><a class="nav-link" href="{{ nav_item.url }}" {% if current_page == nav_item.key %}aria-current="page"{% endif %}>{{ nav_item.title }}</a></li>
          {% endfor %}
          {% if overflow and overflow|length > 0 %}
          <li class="more" aria-haspopup="true" aria-expanded="false">
            <button type="button" aria-label="More">More ▾</button>
            <div class="more-menu" role="menu">
              {% for nav_item in overflow %}
              <a class="nav-link" role="menuitem" href="{{ nav_item.url }}" {% if current_page == nav_item.key %}aria-current="page"{% endif %}>{{ nav_item.title }}</a>
              {% endfor %}
            </div>
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </header>

  <main id="content" class="container" role="main">
    {% if breadcrumbs %}
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol style="list-style:none;display:flex;gap:.5rem;padding:0;margin:0">
        {% for crumb in breadcrumbs %}
        <li>
          {% if crumb.url %}<a href="{{ crumb.url }}">{{ crumb.title }}</a>{% else %}{{ crumb.title }}{% endif %}
        </li>
        {% if not loop.last %}<li aria-hidden="true">›</li>{% endif %}
        {% endfor %}
      </ol>
    </nav>
    {% endif %}

    <div class="main-layout">
      <div class="main-content">
        {% block content %}{% endblock %}
      </div>
      
      {% if games and games|length > 0 %}
      <aside class="sidebar" role="complementary" aria-label="More Games">
        <h3>🎮 {{ sidebar_title }}</h3>
        <div class="games-widget">
              {% for game in games %}
              <a href="{{ game.url }}" class="game-widget-item" title="Play {{ game.title }} online">
                <img src="{{ game.image }}" alt="Play {{ game.title }} - {{ site_name }}" class="game-widget-thumb" loading="lazy" decoding="async" width="50" height="50">
                <div class="game-widget-title">{{ game.title }}</div>
              </a>
              {% endfor %}
        </div>
        {% if games|length > 3 %}
        <div style="text-align:center;margin-top:1rem;">
          <a href="games.html" style="font-size:0.85rem;color:var(--brand);font-weight:500;">View All Games →</a>
        </div>
        {% endif %}
      </aside>
      {% endif %}
    </div>
  </main>
  
  <footer role="contentinfo" class="container">
    <small>© <span id="year">{{ current_year }}</span> {{ site_domain }} · 
    {% for footer_link in footer_links %}
    <a href="{{ footer_link.url }}">{{ footer_link.title }}</a>{% if not loop.last %} · {% endif %}
    {% endfor %}
    </small>
  </footer>
  
  <script defer>
  document.addEventListener('DOMContentLoaded',()=>{
    const y=document.getElementById('year'); 
    if(y) y.textContent=new Date().getFullYear();
    
    // Mobile menu toggle
    const menuBtn = document.getElementById('menu');
    const nav = document.getElementById('nav');
    if(menuBtn && nav) {
      menuBtn.addEventListener('click', () => {
        const expanded = nav.getAttribute('aria-expanded') === 'true';
        nav.setAttribute('aria-expanded', !expanded);
        menuBtn.setAttribute('aria-expanded', !expanded);
      });
    }

    // Desktop More dropdown toggle (click + keyboard)
    const more = document.querySelector('nav .more');
    if(more){
      const btn = more.querySelector('button');
      const menu = more.querySelector('.more-menu');
      const close = ()=>{ more.setAttribute('aria-expanded','false'); };
      const open = ()=>{ more.setAttribute('aria-expanded','true'); };
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const expanded = more.getAttribute('aria-expanded')==='true';
        more.setAttribute('aria-expanded', (!expanded).toString());
      });
      document.addEventListener('click', (e)=>{
        if(!more.contains(e.target)) close();
      });
      more.addEventListener('keydown',(e)=>{
        if(e.key==='Escape') close();
      });
    }

    // Sidebar toggle for mobile
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const sidebar = document.querySelector('.sidebar');
    if(sidebarToggle && sidebar) {
      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('collapsed');
        const isCollapsed = sidebar.classList.contains('collapsed');
        sidebarToggle.textContent = isCollapsed ? 'Show Games' : 'Hide Games';
      });
    }
  });
  </script>
  
  <!-- Form message function -->
  <script>
  function showMessage(message) {
    const messageDiv = document.getElementById('form-message');
    if (messageDiv) {
      messageDiv.textContent = message;
      // Use requestAnimationFrame to avoid forced reflow
      requestAnimationFrame(() => {
        messageDiv.style.display = 'block';
      });
      // Hide message after 5 seconds - also optimized
      setTimeout(() => {
        requestAnimationFrame(() => {
          messageDiv.style.display = 'none';
        });
      }, 5000);
    }
  }
  </script>
  
  {% block extra_js %}{% endblock %}
  
  <!-- Custom Footer Code (Analytics, Pixels, etc.) -->
  {% if custom_footer_code %}
  {{ custom_footer_code | safe }}
  {% endif %}
</body>
</html>

