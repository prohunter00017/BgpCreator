<!doctype html>
<html lang="{{ language }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="locale" content="{{ locale }}">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>{{ page_title }} – {{ site_name }}</title>
  <meta name="description" content="{{ page_description }}">
  <link rel="canonical" href="{{ canonical_url }}">
  <meta name="robots" content="{{ robots_content }}">
  
  <!-- Core Web Vitals Optimizations -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preload" href="/assets/css/styles.css?v=2" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/styles.css?v=2"></noscript>
  
  <!-- Optimize font loading -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
  
  <!-- Open Graph -->
  <meta property="og:type" content="{{ og_type }}">
  <meta property="og:site_name" content="{{ site_name }}">
  <meta property="og:title" content="{{ page_title }} – {{ site_name }}">
  <meta property="og:description" content="{{ page_description }}">
  <meta property="og:url" content="{{ canonical_url }}">
  <meta property="og:image" content="{{ site_url }}{{ og_image }}">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title }} – {{ site_name }}">
  <meta name="twitter:description" content="{{ page_description }}">
  <meta name="twitter:image" content="{{ site_url }}{{ og_image }}">

  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="{{ theme_color }}">
  
  <!-- Favicon links for different sizes and devices -->
  {% for favicon in favicon_links %}
  <link rel="{{ favicon.rel }}" type="{{ favicon.type }}"{% if favicon.sizes %} sizes="{{ favicon.sizes }}"{% endif %} href="{{ favicon.href }}">
  {% endfor %}

  <style>
    /* Critical CSS - Dark Theme Above the fold styles */
    :root{
      --bg:#000; --fg:#fff; --muted:#999; --brand:#4a9eff; --brand-2:#357acc; --surface:#222; --radius:8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html:focus-within{scroll-behavior:smooth}
    body{margin:0;background:var(--bg);color:var(--fg);line-height:1.6;min-height:100vh}
    a{color:var(--brand);text-decoration:none}
    a:hover{color:#357acc}
    :focus{outline:2px solid var(--brand);outline-offset:2px}
    .container{max-width:1400px;margin:0 auto;padding:0 20px}
    /* Dark theme header with centered logo */
    header{position:sticky;top:0;background:#111;border-bottom:1px solid #333;z-index:1000;padding:15px 0}
    .topbar{display:flex;flex-direction:column;align-items:center;gap:15px}
    .brand{display:flex;align-items:center;justify-content:center}
    .brand-link{display:flex;align-items:center;text-decoration:none}
    .brand-link:hover{text-decoration:none}
    .brand-logo{height:50px;width:auto;object-fit:contain}
    /* Dark theme navigation */
    nav{width:100%;display:flex;justify-content:center}
    nav ul{display:flex;gap:0;list-style:none;margin:0;padding:0;background:#222;border-radius:8px;overflow:hidden}
    .nav-link{padding:10px 20px;font-size:14px;font-weight:500;display:block;text-decoration:none;color:#ccc;border-right:1px solid #333;transition:all 0.3s ease}
    .nav-link:last-child{border-right:none}
    .nav-link:focus,.nav-link:hover,.nav-link[aria-current="page"]{background:#4a9eff;color:#fff;text-decoration:none}
    /* Dark theme mobile menu button */
    .menu-btn{display:none;background:#222;border:1px solid #333;padding:10px 20px;border-radius:8px;font-weight:500;color:#fff;cursor:pointer;transition:all 0.2s ease;font-size:14px}
    .menu-btn:hover{background:#4a9eff;border-color:#4a9eff}
    .menu-btn:focus{outline:2px solid #4a9eff;outline-offset:2px}

    /* Dark theme more dropdown */
    .more{position:relative}
    .more > button{padding:10px 15px;border-radius:8px;border:1px solid #333;background:#222;color:#fff;cursor:pointer;transition:all 0.3s ease}
    .more[aria-expanded="true"] > button,.more > button:hover{background:#4a9eff;color:#fff;border-color:#4a9eff}
    .more-menu{display:none;position:absolute;top:110%;right:0;min-width:200px;background:#222;border:1px solid #333;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.5);overflow:hidden;z-index:50}
    .more[aria-expanded="true"] .more-menu{display:block}
    .more-menu a{display:block;padding:10px 15px;color:#ccc;border-bottom:1px solid #333}
    .more-menu a:last-child{border-bottom:none}
    .more-menu a:hover{background:#4a9eff;color:#fff;text-decoration:none}

    /* Dark theme mobile menu */
    @media (max-width: 767px){
      .topbar{flex-direction:row;justify-content:space-between}
      nav{position:relative}
      nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:#222;border:1px solid #333;margin-top:10px;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.5);z-index:30}
      nav[aria-expanded="true"] ul{display:flex;flex-direction:column;align-items:stretch;padding:0;gap:0}
      nav[aria-expanded="true"] .nav-link{padding:12px 16px;width:100%;border-radius:0;text-align:left;font-size:14px;border-bottom:1px solid #333;border-right:none}
      nav[aria-expanded="true"] .nav-link:last-child{border-bottom:none}
      nav[aria-expanded="true"] .nav-link:hover{background:#4a9eff;color:#fff}
      .menu-btn{display:block;position:relative;z-index:40}
    }
    
    /* Mobile responsive */
    @media (max-width: 480px){
      .container{padding:0 10px}
      .topbar{padding:10px 0}
      .brand-logo{height:40px}
      .nav-link{font-size:13px;padding:10px 14px}
      .menu-btn{padding:8px 15px;font-size:13px}
    }

    main{display:block;min-height:calc(100vh - 200px);padding:40px 0}
    .main-layout{margin:0}
    /* Dark theme footer */
    footer{padding:30px 20px;border-top:1px solid #333;background:#111;text-align:center;font-size:13px;color:#999;margin-top:60px}
    footer a{color:#ccc;text-decoration:none;margin:0 10px}
    footer a:hover{color:#4a9eff;text-decoration:none}
    .footer-links{display:flex;flex-wrap:wrap;gap:20px;justify-content:center;margin:20px 0}

    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{position:static;width:auto;height:auto;padding:.5rem;border:1px dashed var(--brand);background:#000;color:#fff}
    
    /* Dark theme back-to-top button */
    .back-to-top{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:#4a9eff;color:#fff;border:none;border-radius:50%;cursor:pointer;opacity:0;visibility:hidden;transition:all 0.3s ease;z-index:1000;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 2px 8px rgba(0,0,0,.5)}
    .back-to-top.show{opacity:1;visibility:visible}
    .back-to-top:hover{background:#357acc;transform:translateY(-3px);box-shadow:0 4px 16px rgba(0,0,0,.7)}
    
    {% block extra_css %}{% endblock %}
  </style>

  {% block extra_head %}{% endblock %}

  {% if organization_schema and organization_schema.name %}
  <!-- Schema.org JSON-LD - Organization Schema -->
  <script type="application/ld+json">
  {{ organization_schema | tojson | safe }}
  </script>
  {% endif %}
  
  {% if website_schema %}
  <!-- Schema.org JSON-LD - WebSite Schema -->
  <script type="application/ld+json">
  {{ website_schema | tojson | safe }}
  </script>
  {% endif %}
  
  <!-- Custom Head Code (Analytics, Pixels, etc.) -->
  {% if custom_head_code %}
  {{ custom_head_code | safe }}
  {% endif %}
  
  <!-- Google Analytics -->
  {% if google_analytics_code %}
  {{ google_analytics_code | safe }}
  {% endif %}
  
</head>
<body>
  <!-- Custom Body Code (Widgets, Popups, etc.) -->
  {% if custom_body_code %}
  {{ custom_body_code | safe }}
  {% endif %}
  
  <a class="skip-link" href="#content">Skip to content</a>
  <header>
    <div class="container topbar" role="banner">
      <div class="brand" aria-label="Site brand">
        <a href="{% if current_page == 'index' %}{{ site_url.rstrip('/') }}{% else %}/index.html{% endif %}" class="brand-link" {% if current_page == 'index' %}aria-current="page"{% endif %}>
          <img src="/logo.png" alt="Slither io" class="brand-logo">
        </a>
      </div>
      <button id="menu" class="menu-btn" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">Menu</button>
      <nav id="nav" aria-label="Primary">
        {% set primary = navigation[:5] %}
        {% set overflow = navigation[5:] %}
        <ul>
          {% for nav_item in primary %}
          <li><a class="nav-link" href="{{ nav_item.url }}" {% if current_page == nav_item.key %}aria-current="page"{% endif %}>{{ nav_item.title }}</a></li>
          {% endfor %}
          {% if overflow and overflow|length > 0 %}
          <li class="more" aria-haspopup="true" aria-expanded="false">
            <button type="button" aria-label="More">More ▾</button>
            <div class="more-menu" role="menu">
              {% for nav_item in overflow %}
              <a class="nav-link" role="menuitem" href="{{ nav_item.url }}" {% if current_page == nav_item.key %}aria-current="page"{% endif %}>{{ nav_item.title }}</a>
              {% endfor %}
            </div>
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </header>

  <main id="content" class="container" role="main">
    {% if breadcrumbs %}
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol style="list-style:none;display:flex;gap:.5rem;padding:0;margin:0">
        {% for crumb in breadcrumbs %}
        <li>
          {% if crumb.url %}<a href="{{ crumb.url }}">{{ crumb.title }}</a>{% else %}{{ crumb.title }}{% endif %}
        </li>
        {% if not loop.last %}<li aria-hidden="true">›</li>{% endif %}
        {% endfor %}
      </ol>
    </nav>
    {% endif %}

    <div class="main-layout">
      {% block content %}{% endblock %}
    </div>
  </main>
  
  <footer role="contentinfo" class="container">
    <small>© <span id="year">{{ current_year }}</span> {{ site_domain }} · 
    {% for footer_link in footer_links %}
    <a href="{{ footer_link.url }}">{{ footer_link.title }}</a>{% if not loop.last %} · {% endif %}
    {% endfor %}
    </small>
  </footer>
  
  <!-- escaperoad.io back-to-top button -->
  <button class="back-to-top" id="backToTop" aria-label="Back to top" title="Back to top">
    ↑
  </button>
  
  <script defer>
  document.addEventListener('DOMContentLoaded',()=>{
    const y=document.getElementById('year'); 
    if(y) y.textContent=new Date().getFullYear();
    
    // Mobile menu toggle
    const menuBtn = document.getElementById('menu');
    const nav = document.getElementById('nav');
    if(menuBtn && nav) {
      menuBtn.addEventListener('click', () => {
        const expanded = nav.getAttribute('aria-expanded') === 'true';
        nav.setAttribute('aria-expanded', !expanded);
        menuBtn.setAttribute('aria-expanded', !expanded);
      });
    }

    // Desktop More dropdown toggle (click + keyboard)
    const more = document.querySelector('nav .more');
    if(more){
      const btn = more.querySelector('button');
      const menu = more.querySelector('.more-menu');
      const close = ()=>{ more.setAttribute('aria-expanded','false'); };
      const open = ()=>{ more.setAttribute('aria-expanded','true'); };
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const expanded = more.getAttribute('aria-expanded')==='true';
        more.setAttribute('aria-expanded', (!expanded).toString());
      });
      document.addEventListener('click', (e)=>{
        if(!more.contains(e.target)) close();
      });
      more.addEventListener('keydown',(e)=>{
        if(e.key==='Escape') close();
      });
    }


    // escaperoad.io back-to-top button functionality
    const backToTop = document.getElementById('backToTop');
    if(backToTop) {
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          backToTop.classList.add('show');
        } else {
          backToTop.classList.remove('show');
        }
      });
      
      backToTop.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }
  });
  </script>
  
  <!-- Form message function -->
  <script>
  function showMessage(message) {
    const messageDiv = document.getElementById('form-message');
    if (messageDiv) {
      messageDiv.textContent = message;
      // Use requestAnimationFrame to avoid forced reflow
      requestAnimationFrame(() => {
        messageDiv.style.display = 'block';
      });
      // Hide message after 5 seconds - also optimized
      setTimeout(() => {
        requestAnimationFrame(() => {
          messageDiv.style.display = 'none';
        });
      }, 5000);
    }
  }
  </script>
  
  {% block extra_js %}{% endblock %}
  
  <!-- Custom Footer Code (Analytics, Pixels, etc.) -->
  {% if custom_footer_code %}
  {{ custom_footer_code | safe }}
  {% endif %}
</body>
</html>

